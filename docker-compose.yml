version: "3.8"

services:

  scrapydweb:
    image: bardusco/scrapy-platform
    command: scrapydweb
    ports:
      - "5000:5000"
    volumes:
      - scrapyd-data:/app/scrapyd
      - scrapydweb-data:/app/scrapydweb
    environment:
      - PASSWORD
      - USERNAME
      - SCRAPYD_SERVERS
      - SCRAPYD_USERNAME
      - SCRAPYD_PASSWORD
      - TELEGRAM_TOKEN
      - TELEGRAM_CHAT_ID
    restart: unless-stopped

  scrapyd:
    image: bardusco/scrapy-platform
    entrypoint: ["/app/scrapyd-config-setup.sh"]
    command: scrapyd
    ports:
      - "6800:6800"
    volumes:
      - scrapyd-data:/app/scrapyd
    environment:
      - SPLASH_URL
      - WEBHOOK_URL
      - SCRAPYDWEB_URL
      - SCRAPYD_USERNAME
      - SCRAPYD_PASSWORD
      - TELEGRAM_CHAT_ID
    restart: unless-stopped

  splash:
    image: whalebothelmsman/splash
    ports:
      - "8050:8050"
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '3.0'
          memory: 2048M

volumes:
  scrapyd-data:
  scrapydweb-data:
